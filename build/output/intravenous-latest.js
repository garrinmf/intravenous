// Intravenous JavaScript library v0.1.4-beta
// (c) Roy Jacobs
// License: MIT (http://www.opensource.org/licenses/mit-license.php)

(function(window,undefined){
function r(h){function s(p,q){for(var l=p.split("."),n=h,m=0;m<l.length-1;m++)n=n[l[m]];n[l[l.length-1]]=q}h="undefined"!==typeof h?h:{};h.version="0.1.4-beta";s("version",h.version);(function(){function p(a,b,d){var c=q(a,b);b=c.key;for(var c=c.data,e,f=a;f&&!(e=f.j[b]);)f=f.parent;if(c&&c.r){var g=c.r(a,b,e);if(g.h)return g.data}if(!f)throw Error("Unknown dependency: "+b);if(c&&c.t&&(g=c.t(a,b,e),g.h))return g.data;if(c=a.c[e.l].get(b))return c;var k;if(e.value instanceof Function){c=e.value.$inject;
!c&&0>=d.length&&(c=e.value.toString().replace(/((\/\/.*$)|(\/\*[\s\S]*?\*\/)|(\s))/mg,"").match(/^function\s*[^\(]*\(\s*([^\)]*)\)/m)[1].split(/,/),""===c[0]&&(c=null));k=[];if(c instanceof Array)for(f=0,g=c.length;f<g;f++)k.push(p(a,c[f],[]));c=function(){};c.prototype=e.value.prototype;c=new c;f=0;for(g=d.length;f<g;f++)k.push(d[f]);k=e.value.apply(c,k);if(k instanceof Function){c=new m(a,b);c.a.i(b,k);for(var h in k)k.hasOwnProperty(h)&&(c[h]=k[h]);k=void 0}}else c=e.value;a.c[e.l].set(new w(e,
c));return k||c}function q(a,b){for(var d in a.s)for(var c=a.s[d],e=0,f=c.suffixes.length;e<f;e++){var g=c.suffixes[e];if(-1!==b.indexOf(g,b.length-g.length))return{data:c,key:b.slice(0,b.length-g.length)}}return{data:null,key:b}}function l(a,b){this.j={};this.parent=b;this.c={perRequest:new t(this),singleton:new u(this,b?b.c.singleton:null),unique:new v(this)};this.children=[];this.options=a=a||{};this.i("container",this);this.dispose=this.f;this.get=this.get;this.register=this.i}function n(a,b){this.a=
a;this.key=b;this.dispose=this.f;this.get=this.get;this.use=this.k}function m(a,b){this.a=a.create();this.key=b;this.dispose=this.f;this.get=this.get;this.use=this.k}function v(a){this.a=a;this.b=[]}function u(a,b){this.a=a;this.b=[];this.e={};this.parent=b}function t(a){this.a=a;this.b=[];this.e={};this.tag=0;this.o={};this.p=[]}function w(a,b){this.d=a;this.g=b}function x(a,b,d,c){this.key=a;this.a=b;this.value=d;this.l=c}t.prototype={get:function(a){for(var b=0,d=this.b.length;b<d;b++){var c=this.b[b];
if(c.d.key===a&&c.tag===this.tag){if(!c.g)break;this.set(c);return c.g}}this.p.push(a);if(this.o[a])throw Error("Circular reference: "+this.p.join(" --\x3e "));this.o[a]=!0;return null},set:function(a){this.b.push(a);a.tag=this.tag;this.e[a.tag]=this.e[a.tag]||{};this.e[a.tag][a.d.key]=this.e[a.tag][a.d.key]++||1},m:function(a){return!--this.e[a.tag][a.d.key]},n:function(){this.tag++;this.o={};this.p=[]}};u.prototype={get:function(a){for(var b=0,d=this.b.length;b<d;b++){var c=this.b[b];if(c.d.key===
a){if(!c.g)break;this.set(c);return c.g}}return this.parent?this.parent.get(a):null},set:function(a){this.b.push(a);this.e[a.d.key]=this.e[a.d.key]++||1},m:function(a){return!--this.e[a.d.key]},n:function(){}};v.prototype={get:function(){return null},set:function(a){this.b.push(a)},m:function(){return!0},n:function(){}};m.prototype={get:function(){var a=Array.prototype.slice.call(arguments);a.unshift(this.key);a=this.a.get.apply(this.a,a);a.q=this;return a},k:function(a,b,d){this.a.i(a,b,d);return this},
f:function(){this.a.f()}};n.prototype={get:function(){var a=new m(this.a,this.key);return a.get.apply(a,arguments)},k:function(a,b,d){return(new m(this.a,this.key)).k(a,b,d)},f:function(a){a.q.f();delete a.q}};l.prototype={s:{v:{suffixes:["?"],r:function(a,b,d){return d?{h:!1}:{h:!0,data:null}}},factory:{suffixes:["Factory","!"],t:function(a,b){return{h:!0,data:new n(a,b)}}}},i:function(a,b,d){if(q(this,a).data)throw Error("Cannot register dependency: "+a);!d&&this.j[a]?this.j[a].value=b:this.j[a]=
new x(a,this,b,d||"perRequest")},get:function(a){for(var b in this.c)this.c.hasOwnProperty(b)&&this.c[b].n(a);b=Array.prototype.slice.call(arguments).slice(1);for(var d=this,c;d&&null===(c=p(d,a,b));)d=d.parent;return c},f:function(){for(var a;a=this.children.pop();)a.f();for(var b=this.u();a=b.pop();)if(this.c[a.d.l].m(a)&&this.options.onDispose)this.options.onDispose(a.g,a.d.key);return!0},create:function(a){a=a||{};a.onDispose=a.onDispose||this.options.onDispose;a=new l(a,this);this.children.push(a);
return a},u:function(){var a=[],b;for(b in this.c)this.c.hasOwnProperty(b)&&(a=a.concat(this.c[b].b));return a}};h.create=function(a){return new l(a)};s("create",h.create)})()}"function"===typeof require&&"object"===typeof exports&&"object"===typeof module?r(module.exports||exports):"function"===typeof define&&define.amd?define(["exports"],r):r(window.intravenous={});!0;
})(typeof window !== "undefined" ? window : global);
